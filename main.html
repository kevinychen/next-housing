<!DOCTYPE html>
<html>
	<head>
		<title>Unofficial Next Housing</title>
		<link rel="stylesheet" type="text/css" href="style/reset.css" />
		<link rel="stylesheet" type="text/css" href="style/style.css" />
		<link rel="stylesheet" type="text/css" href="plugins/foundation/css/foundation.css" />
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
		<script src='https://cdn.firebase.com/v0/firebase.js'></script>
		<!--
			<script type="text/javascript" src="next-housing.js"></script>
		-->
		<script>
			// to be moved to a seperate file later, I'm a little lazy
			function nameTag(r, n){
				return "<div class='nametag'><span class='rank'>" + r + "</span>" + n + "</div>";
			}
			function moreTag(roomNum,k){
				return "<div id='fullroombtn" + roomNum + "' class='hiddenlistbtn moretag'>+ " + k +" more</div>";
			}

			$(document).ready(function(){
				var numRooms = 74;
				var html = "<table>";
				html += "<tr><th>Room</th><th>Contestants</th></tr>";
				for (i = 1; i < numRooms; i ++){
					roomNum = i + 200;
					html += "<tr>";
					html += "<td class='roomnum-table'>" + roomNum + "</td>";
					html += "<td id='room" + roomNum +"'>untaken</td>";
					html += "</tr>";
				}
				html += "</table>"
				$("#floor2 .roomlisting").html(html);


				var data = new Firebase('https://kyc.firebaseIO.com/');
				data.on('value', function(snapshot) {
					obj = snapshot.val();
					for (k in Object.keys(obj.rooms)){
						roomNum = Object.keys(obj.rooms)[k]
						contestantslist = Object.keys(obj.rooms[roomNum]);
						html = ""

						if (contestantslist.length > 0){
							contestant = contestantslist[0];
							r = obj.rooms[roomNum][contestant].rank;
							html += nameTag(r, contestant);

							// if more than one person
							if (contestantslist.length > 1){
								html += "<div id='fullroom" + roomNum + "' class='hiddenlist' style='display:none'>";
								// people who are not the first
								for (i in contestantslist){
									if (i != 0){
										contestant = contestantslist[i];
										r = obj.rooms[roomNum][contestant].rank;
										html += nameTag(r, contestantslist[i]);
									}
								}
								nummore = contestantslist.length - 1
								html += "</div>";
								html += moreTag(roomNum, nummore);

								selector = $("#fullroombtn" + roomNum);
								$("#room" + roomNum).on("click", selector, function(){
									roomid = $(this).attr('id')
									$("#" + roomid + " .hiddenlist").show();
									$("#" + roomid + " .hiddenlistbtn").hide();
								});
							}
						}

						$("#room" + roomNum).html(html);
					}

				});

			});
		</script>
	</head>
	<body>
		<div class="row">
			<div class="header large-12">
				<h1>
					Unofficial Next House Room Finder
				</h1>
		 	</div>
		</div>
		<div class="row">
			<div class="large-12 columns instructions">
				<h2>Hello There</h2>
				<p>
					You are going on an adventure. A far away land.
				</p>
		 	</div>
		</div>
		<div class="row">
			<div class="large-12 columns floorheaders">
				FLOOR 2
		 	</div>
		</div>
		<div id="floor2" class="row">
			<div class="large-2 columns roomlisting">
				<!-- roomlistings -->
			</div>
			<div class="large-10 columns">
				<div class='map'>
					map
				</div>
			</div>
		</div>
	</body>
</html>

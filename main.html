<!DOCTYPE html>
<html>
	<head>
		<title>Unofficial Next Housing</title>
		<link rel="stylesheet" type="text/css" href="style/reset.css" />
        <link rel="stylesheet" href="style.css">
		<link rel="stylesheet" type="text/css" href="style/style.css" />
		<link rel="stylesheet" type="text/css" href="plugins/foundation/css/foundation.css" />
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="OpenLayers.js"></script>
		<script src='https://cdn.firebase.com/v0/firebase.js'></script>
		<script>
			// to be moved to a seperate file later, I'm a little lazy
			function nameTag(r, n){
				return "<div class='nametag'><span class='rank'>" + r + "</span>" + n + "</div>";
			}

			function moreTag(roomNum,k){
				return "<div id='fullroombtn" + roomNum + "' class='hiddenlistbtn moretag'>+ " + k +" more</div>";
			}

			$(document).ready(function(){

				var numRooms = 77;
				currSelectRoom = false;

				ss = [8, 12, 22, 26, 34, 44, 56, 75];
				sd = [20, 14, 66, 75];
				dne = [228, 229, 230, 217, 245, 247, 248, 249, 255, 267, 273,
						317, 345, 347, 348, 349, 367, 373,
						417, 445, 447, 448, 449, 467, 473,
						517, 545, 547, 548, 549, 567, 573];

				for (floor = 2; floor <= 5; floor ++){
					var html = "<table>";
					html += "<tr><th>Room</th><th>Contestants</th></tr>";
					for (i = 1; i < numRooms; i ++){
						roomNum = i + floor * 100;
						if (dne.indexOf(roomNum) == -1){
							html += "<tr>";
							if (floor > 2 && ss.indexOf(i) > -1){
								img = "<img src='style/solarsing.png' />";
							} else if (floor > 2 && sd.indexOf(i) > -1){
								img = "<img src='style/solardoub.png' />";
							} else {
								img = "";
							}

							html += "<td class='roomnum-table'>" + roomNum + " " + img + "</td>";
							html += "<td id='room" + roomNum +"'>none</td><td class='chooseroombtnlist'><a title='choose this room' href='#' id='plus" + roomNum + "'>+</a></td>";

							html += "</tr>";
						}
					}
					html += "</table>";
					$("#floor" + floor + " .roomlisting").html(html);
				}

				var data = new Firebase('https://kyc.firebaseIO.com/');
				data.on('value', function(snapshot) {

					obj = snapshot.val();
                    console.log(obj);
					for (k in Object.keys(obj.rooms)){
						roomNum = Object.keys(obj.rooms)[k]
						contestantslist = Object.keys(obj.rooms[roomNum]);
						html = ""


						if (contestantslist.length > 0){
							contestant = contestantslist[0];
							r = obj.rooms[roomNum][contestant].rank;
							html += nameTag(r, contestant);

							// if more than one person
							if (contestantslist.length > 1){
								html += "<div id='fullroom" + roomNum + "' class='hiddenlist' style='display:none'>";
								// people who are not the first
								for (i in contestantslist){
									if (i != 0){
										contestant = contestantslist[i];
										r = obj.rooms[roomNum][contestant].rank;
										html += nameTag(r, contestantslist[i]);
									}
								}
								nummore = contestantslist.length - 1
								html += "</div>";
								html += moreTag(roomNum, nummore);

								selector = $("#fullroombtn" + roomNum);
								$("#room" + roomNum).on("click", selector, function(){
									roomid = $(this).attr('id')
									$("#" + roomid + " .hiddenlist").show();
									$("#" + roomid + " .hiddenlistbtn").hide();
								});
							}
						} 

						$("#room" + roomNum).html(html);
					}




				f2 = $("#floorheader2").position().top;
				f3 = $("#floorheader3").position().top;
				f4 = $("#floorheader4").position().top;
				f5 = $("#floorheader5").position().top;

				$(document).scroll(function() {

					if (window.pageYOffset > f2){
						$("#floorheader2").css({"position": "fixed"});
						$("#floorheader2").css({"top": "0"});
						$("#floorheader2").css({"z-index": "100"});
					} else {
						$("#floorheader2").css({"position": "relative"});
						//$("#floorheader2").css({"z-index": "-4"});
					}

					if (window.pageYOffset > f3){
						$("#floorheader3").css({"position": "fixed"});
						$("#floorheader3").css({"top": "0"});
						$("#floorheader3").css({"z-index": "101"});
					} else {
						$("#floorheader3").css({"position": "relative"});
						//$("#floorheader3").css({"z-index": "-3"});
					}

					if (window.pageYOffset > f4){
						$("#floorheader4").css({"position": "fixed"});
						$("#floorheader4").css({"top": "0"});
						$("#floorheader4").css({"z-index": "102"});
					} else {
						$("#floorheader4").css({"position": "relative"});
						//$("#floorheader4").css({"z-index": "-2"});
					}

					if (window.pageYOffset > f5){
						$("#floorheader5").css({"position": "fixed"});
						$("#floorheader5").css({"top": "0"});
						$("#floorheader5").css({"z-index": "103"});
					} else {
						$("#floorheader5").css({"position": "relative"});
						//$("#floorheader5").css({"z-index": "-1"});
					}

				});





				});

				$("tr").hover(function(){
					console.log($(this));
				});

				$("#choice1").click(function(){
					if (currSelectRoom != 1){
						disableChoosing();
						enableChoosing(1);
					} else {
						disableChoosing();
					}
				});

				$("#choice2").click(function(){
					if (currSelectRoom != 2){
						disableChoosing();
						enableChoosing(2);
					} else {
						disableChoosing();
					}
				});

				$("#choice3").click(function(){
					if (currSelectRoom != 3){
						disableChoosing();
						enableChoosing(3);
					} else {
						disableChoosing();
					}
				});

                // moved enableChoosing & disableChoosing to next-housing.js.
			});
		</script>
        <script type="text/javascript" src="next-housing.js"></script>
	</head>
	<body onload="init()">
		<div class="row">
			<div class="header large-12">
				<h1>
					Unofficial Next House Room Finder
				</h1>
		 	</div>
		</div>
		<div class="row">
			<div class="large-12 columns instructions">
				<h2>Hello There. Please Read:</h2>
				<p>
					Choose the top 3 rooms you'd like to stay in for the 2013-2014 year. Help each other out - avoid conflicts before the lottery!
				</p>
		 	</div>
		 	<!--
			<a href="#floor2anchor">
			<div class="large-1 columns floorbtn"> 
					FLOOR <em>2</em>
		 	</div>
			</a>
			<a href="#floor3anchor">
			<div class="large-1 columns floorbtn">
				FLOOR <em>3</em>
		 	</div>
			</a>
			<a href="#floor4anchor">
			<div class="large-1 columns floorbtn">
				FLOOR <em>4</em>
		 	</div>
			</a>
			<a href="#floor5anchor">
			<div class="large-1 columns floorbtn">
				FLOOR <em>5</em>
		 	</div>
			</a>
			-->
		</div>
		<!-- floor 2 -->
		<a name="floor2anchor"></a>
		<div class="row">
			<div id="floorheader2" class="large-12 columns floorheaders">
				FLOOR 2
		 	</div>
		</div>
		<div id="floor2" class="row">
			<div class="large-2 columns roomlisting">
				<!-- roomlistings -->
			</div>
			<div class="large-10 columns">
				<div class='map'>
                    <div id="map2" class="largemap"></div>
				</div>
			</div>
		</div>

		<!-- floor 3, you're moving up in life now. -->
		<a name="floor3anchor"></a>
		<div class="row">
			<div id="floorheader3" class="large-12 columns floorheaders">
				FLOOR 3
		 	</div>
		</div>
		<div id="floor3" class="row">
			<div class="large-2 columns roomlisting">
				<!-- roomlistings -->
			</div>
			<div class="large-10 columns">
				<div class='map'>
                    <div id="map3" class="largemap"></div>
				</div>
			</div>
		</div>

		<!-- floor 4, now we're talking. -->
		<a name="floor4anchor"></a>
		<div class="row">
			<div id="floorheader4" class="large-12 columns floorheaders">
				FLOOR 4
		 	</div>
		</div>
		<div id="floor4" class="row">
			<div class="large-2 columns roomlisting">
				<!-- roomlistings -->
			</div>
			<div class="large-10 columns">
				<div class='map'>
					map of <b>FLOOR 4</b> goes here
				</div>
			</div>
		</div>

		<!-- floor 5, aww, you broke it. -->
		<a name="floor5anchor"></a>
		<div class="row">
			<div id="floorheader5" class="large-12 columns floorheaders">
				FLOOR 5
		 	</div>
		</div>
		<div id="floor5" class="row">
			<div class="large-2 columns roomlisting">
				<!-- roomlistings -->
			</div>
			<div class="large-10 columns">
				<div class='map'>
					map of <b>FLOOR 5</b> goes here
				</div>
			</div>
		</div>
		<div id='footer'>
			Hello, Victor Hung.
			<div id='choice1' class='choiceRoomBtn'>Choose #1</div>
			<div id='remove1' class='choiceRoomBtn'></div>
			<div id='choice2' class='choiceRoomBtn'>Choose #2</div>
			<div id='remove2' class='choiceRoomBtn'></div>
			<div id='choice3' class='choiceRoomBtn'>Choose #3</div>
			<div id='remove3' class='choiceRoomBtn'></div>
			<div id='shortcuts'>
				Jump to: 
				<a href="#floor2anchor">Floor 2</a>
				<a href="#floor3anchor">Floor 3</a>
				<a href="#floor4anchor">Floor 4</a>
				<a href="#floor5anchor">Floor 5</a>
			</div>
		</div>
				<div id='oops'>
					Errors? contact vhung@mit.edu
				</div>
	</body>
</html>
